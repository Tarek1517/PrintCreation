import{r as y,o as q,c as u,b as p,i as H,e,t as _,j as Q,B as w,F as V,h as D,H as k,g as f,a as i,k as z,w as E,v as O,J as G,f as W}from"./app-BHs_qdqJ.js";import{u as X}from"./useAxios-CvYkLGhC.js";import{i as B}from"./index-DF90ylPP.js";const Y={class:"flex space-x-2"},Z={class:"w-1/6 mb-2"},K={class:"w-full bg-primary text-gray-300 border border-slate-600 shadow-lg p-2"},ee=["src"],te={class:"mt-4"},se={class:"text-sm"},ae={key:0},oe={key:1},le={class:"w-5/6"},ne={class:"w-full bg-primary border border-slate-500 shadow-lg p-4 mb-5"},re={class:"w-3/12 pr-2"},ce={class:"w-full text-white"},ie={class:"w-9/12 pl-2"},ue={class:"w-full relative text-gray-300"},de=["onClick"],pe={key:0,class:"w-full bg-primary shadow-lg border border-slate-600 pb-5"},me={class:"w-full text-sm text-left"},ve={class:"p-4"},_e=["onUpdate:modelValue"],he=["onUpdate:modelValue"],ge=["onClick"],fe=["onClick"],ke={__name:"SetVariation",setup(be){const h=G(),F=W(),{loading:T,error:xe,sendRequest:g}=X(),l=y(null),b=y(null),a=y({variationDivider:"/",varientSkuPrefix:"Ver-",defaultQty:13,productName:null,defaultPrice:null,defaultStoke:null,variants:[],product_variant:[{option:null,tags:[]}],product_variant_prices:[],variationValues:[]}),C=async()=>{const t=await g({method:"get",url:`/v1/product-variation/${h.params.slug}`});l.value=t.data,I()},L=async()=>{const t=await g({method:"get",url:"/v1/product-variation"});b.value=t.data},I=()=>{l.value&&(a.value.productName=l.value.title,a.value.defaultPrice=l.value.price,a.value.product_variant=JSON.parse(l.value.variationOptions||"[]"),a.value.product_variant_prices=l.value.stocks.map(t=>({id:t.id,title:t.varient,price:t.price,stock:t.stock,sku:t.sku,image:t.image,imgPreview:t.image?`/path/to/image/${t.image}`:null})))},x=()=>{let t=[];a.value.product_variant.forEach(o=>{t.push(o.tags)});const n=S(t),r=a.value.product_variant_prices.map(o=>o.title);n.forEach(o=>{r.includes(o)||a.value.product_variant_prices.push({title:o,price:l.value.discount_price&&l.value.discount_price>0?l.value.discount_price:l.value.price,stock:1,sku:a.value.varientSkuPrefix+o.replace(/\//g,"-")})})},S=(t,n="")=>t.length?t[0].reduce((r,o)=>r.concat(S(t.slice(1),n+o+"/")),[]):[n],R=async()=>{const t=new FormData;Object.keys(a.value).forEach(r=>{Array.isArray(a.value[r])?a.value[r].forEach((o,v)=>{typeof o=="object"&&!(o instanceof File)?Object.keys(o).forEach(d=>{t.append(`${r}[${v}][${d}]`,o[d])}):t.append(`${r}[${v}]`,o)}):t.append(r,a.value[r])}),await g({method:"post",url:"/v1/product-variation",data:t,params:{productSlug:h==null?void 0:h.params.slug},headers:{"Content-Type":"multipart/form-data"}})&&(B.success("Variation Added Successfully"),C(),setTimeout(()=>{F.push("/products")},1e3))},J=()=>{a.value.product_variant.push({option:null,tags:[]})},M=t=>{a.value.product_variant.splice(t,1),x()},$=async(t,n)=>{await g({method:"delete",url:`/v1/product-variation/${t}`})&&(B.success("Variation Deleted Successfully"),a.value.product_variant_prices.splice(n,1))};return q(()=>{L(),C()}),(t,n)=>{var N,U,j,A,P;const r=f("Loading"),o=f("strike"),v=f("Select"),d=f("Icon");return i(),u(V,null,[p(r,{value:H(T)},null,8,["value"]),e("div",Y,[e("div",Z,[e("div",K,[e("img",{class:"w-full h-auto",src:(N=l.value)==null?void 0:N.cover_image},null,8,ee),e("div",te,[e("h3",se,_((U=l.value)==null?void 0:U.title),1),(j=l.value)!=null&&j.discount_price?(i(),u("p",ae,[p(o,{class:"mr-1 text-red-600"},{default:Q(()=>{var s;return[w("৳"+_((s=l.value)==null?void 0:s.price),1)]}),_:1}),w("৳"+_((A=l.value)==null?void 0:A.discount_price),1)])):(i(),u("p",oe,"৳"+_((P=l.value)==null?void 0:P.price),1))])])]),e("div",le,[e("div",ne,[(i(!0),u(V,null,D(a.value.product_variant,(s,m)=>(i(),u("div",{class:"flex mb-3",key:m},[e("div",re,[e("div",ce,[n[0]||(n[0]=e("label",{for:"variation"},[e("span",{class:"text-sm mb-1 block"},"Variation")],-1)),b.value?(i(),z(v,{key:0,label:"name",options:b.value,reduce:c=>c.id,modelValue:s.option,"onUpdate:modelValue":c=>s.option=c,onChange:x,placeholder:"Select Variation.."},null,8,["options","reduce","modelValue","onUpdate:modelValue"])):k("",!0)])]),e("div",ie,[e("div",ue,[m>0?(i(),u("button",{key:0,onClick:c=>M(m),class:"absolute top-0 right-1 bg-primary flex items-center text-xs justify-center w-6 h-5 rounded text-white"},[p(d,{name:"material-symbols:close-small-outline",class:"text-xl text-white"})],8,de)):k("",!0),n[1]||(n[1]=e("label",{class:"text-sm mb-1 block"},"Variation Options",-1)),p(v,{modelValue:s.tags,"onUpdate:modelValue":[c=>s.tags=c,x],label:"name",class:"form-control",multiple:"",taggable:"",placeholder:"Select Variation Options..."},null,8,["modelValue","onUpdate:modelValue"])])])]))),128)),e("button",{onClick:J,class:"mt-3 bg-common flex items-center gap-1 text-xs px-2 py-1 rounded text-white"},[p(d,{name:"material-symbols:add",class:"text-xl text-white"}),n[2]||(n[2]=w(" Add Variation "))])])])]),a.value.product_variant_prices.length>0?(i(),u("div",pe,[e("table",me,[n[3]||(n[3]=e("thead",{class:"text-xs text-gray-300 uppercase bg-secondary"},[e("tr",null,[e("th",{scope:"col",class:"px-16 py-3"},"Variant"),e("th",{scope:"col",class:"px-6 py-3"},"Price"),e("th",{scope:"col",class:"px-6 py-3"},"Stock"),e("th",{scope:"col",class:"px-6 py-3"},"Actions")])],-1)),e("tbody",null,[(i(!0),u(V,null,D(a.value.product_variant_prices,(s,m)=>(i(),u("tr",{key:m,class:"text-gray-300 hover:bg-secondary"},[e("td",ve,_(s.title),1),e("td",null,[E(e("input",{type:"number",class:"p-2 rounded-md border w-36","onUpdate:modelValue":c=>s.price=c},null,8,_e),[[O,s.price]])]),e("td",null,[E(e("input",{type:"number",class:"p-2 rounded-md border w-32","onUpdate:modelValue":c=>s.stock=c},null,8,he),[[O,s.stock]])]),e("td",null,[s!=null&&s.id?(i(),u("button",{key:0,onClick:c=>$(s==null?void 0:s.id),class:"w-8 h-8 bg-primary rounded-md flex items-center justify-center"},[p(d,{name:"material-symbols:delete-outline",class:"text-white text-lg"})],8,ge)):(i(),u("button",{key:1,onClick:c=>$(m),class:"w-8 h-8 bg-primary rounded-md flex items-center justify-center"},[p(d,{name:"material-symbols:delete-outline",class:"text-white text-lg"})],8,fe))])]))),128))])]),e("div",{class:"text-center pt-5"},[e("button",{class:"bg-common text-white w-1/2 py-2",onClick:R},"Save")])])):k("",!0)],64)}}};export{ke as default};
